{
  "hash": "30329b09dd3a879b5813bc7999bf85c5",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"How to improve a bad graph with plotly\"\nauthor: '{{< var author >}}'\ndate: '2025-02-25'\ndate-format: iso\ntoc: true\ntoc-title: 'Sections'\ntoc-location: left\ntoc-depth: 3\n---\n\n\nAll data visualizations should, first and foremost, inform. Any visualization that falls short of this is simply data art. Data visualizations that are uninformative may be bad but misleading ones are the worst. Here's an example of a bad visualization that Olga Berezovsky posted on LinkedIn. I thought I'd recreate it based on the suggestions she highlighted.\n\n::: {.gray-text .center-text}\n![a bad graph](bad_graph.jpg){fig-align=\"center\"}\n:::\n\n## The dataset\nBelow is a polars dataframe showing the data I'll use to recreate the bad graph. This is the original data as it's shown on the bad graph.\n\n::: {#0e1265cc .cell execution_count=1}\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (10, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>Country</th><th>GDP</th></tr><tr><td>str</td><td>i64</td></tr></thead><tbody><tr><td>&quot;USA&quot;</td><td>22670</td></tr><tr><td>&quot;China&quot;</td><td>16640</td></tr><tr><td>&quot;Japan&quot;</td><td>5370</td></tr><tr><td>&quot;Germany&quot;</td><td>4310</td></tr><tr><td>&quot;UK&quot;</td><td>3120</td></tr><tr><td>&quot;India&quot;</td><td>3040</td></tr><tr><td>&quot;France&quot;</td><td>2930</td></tr><tr><td>&quot;Italy&quot;</td><td>2100</td></tr><tr><td>&quot;Canada&quot;</td><td>1880</td></tr><tr><td>&quot;Korea&quot;</td><td>1800</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n<br>\n\nSince the GDP numbers will be presented in trillion and not billion, I'll divide the values by 1,000 and round the values to 2 decimal places. Here's the resulting dataframe.\n\n::: {#e572f9c5 .cell execution_count=2}\n``` {.python .cell-code}\ndf = (data\n      .with_columns((pl.col('GDP') / 1000).round(2))\n     )\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (10, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>Country</th><th>GDP</th></tr><tr><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;USA&quot;</td><td>22.67</td></tr><tr><td>&quot;China&quot;</td><td>16.64</td></tr><tr><td>&quot;Japan&quot;</td><td>5.37</td></tr><tr><td>&quot;Germany&quot;</td><td>4.31</td></tr><tr><td>&quot;UK&quot;</td><td>3.12</td></tr><tr><td>&quot;India&quot;</td><td>3.04</td></tr><tr><td>&quot;France&quot;</td><td>2.93</td></tr><tr><td>&quot;Italy&quot;</td><td>2.1</td></tr><tr><td>&quot;Canada&quot;</td><td>1.88</td></tr><tr><td>&quot;Korea&quot;</td><td>1.8</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Creating a better graph\nI'll develop the graph in a step-by-step manner, addressing the problems Olga highlighted in the bad graph until we have a perfect graph that is not only informative but beautiful to look at. I'll use the graphing library called Plotly.\n\n### Out of the box plot\nHere's a regular plot without employing any tweaks to make it look better.\n\n::: {#295f73c8 .cell execution_count=3}\n``` {.python .cell-code}\nimport plotly.graph_objects as go\n\nfig = go.Figure(go.Bar(\n    x=df[\"Country\"],\n    y=df[\"GDP\"]\n))\n\nfig.show(renderer='iframe')\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<iframe\n    scrolling=\"no\"\n    width=\"100%\"\n    height=\"545px\"\n    src=\"iframe_figures/figure_3.html\"\n    frameborder=\"0\"\n    allowfullscreen\n></iframe>\n```\n:::\n:::\n\n\nThis regular graph solves the problem of rotated country names, making them easier to read without tilting your head. Another problem that we've solve right away is the representation of figures from billion to trillion. However, it's still not clear from this graph that the values are in trillion. In the next iteration, we'll add a title to make this clear.\n\n### Add descriptive title\nThe title is an important part of the graph because it tells us what ot focus on. But some titles can be too vague. You wouldn't, for instance, use a title like *GDP of countries* for this graph. You want to use a descriptive title -- one that tells the audience what to focus on.\n\n::: {#a75a5701 .cell execution_count=4}\n``` {.python .cell-code}\nfig = go.Figure(go.Bar(\n    x=df[\"Country\"],\n    y=df[\"GDP\"]\n))\n\nfig.update_layout(\n    title=\"<b>Countries with the highest nominal GDP</b><br><sup><b>(in US $trillion, 2021)</b></sup>\",\n    title_font=dict(size=20),\n)\n\nfig.show(renderer='iframe')\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<iframe\n    scrolling=\"no\"\n    width=\"100%\"\n    height=\"545px\"\n    src=\"iframe_figures/figure_4.html\"\n    frameborder=\"0\"\n    allowfullscreen\n></iframe>\n```\n:::\n:::\n\n\n### Make GDP values explicit\nIt's very difficult to know the exact GDP values of the countries by looking at the y-axis. To solve this problem, we'll insert the GDP value for each country on top of their respective bar. Additionally, I'll hide the values on the y-axis since they won't be needed anymore.\n\n::: {#e04ef8bf .cell execution_count=5}\n``` {.python .cell-code}\nfig = go.Figure(go.Bar(\n    x=df[\"Country\"],\n    y=df[\"GDP\"],\n    text=df['GDP'],\n    textposition='outside'\n))\n\nfig.update_layout(\n    title=\"<b>Countries with the highest nominal GDP</b><br><sup><b>(in US $trillion, 2021)</b></sup>\",\n    title_font=dict(size=20),\n    yaxis=dict(visible=False),\n)\n\nfig.show(renderer='iframe')\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<iframe\n    scrolling=\"no\"\n    width=\"100%\"\n    height=\"545px\"\n    src=\"iframe_figures/figure_5.html\"\n    frameborder=\"0\"\n    allowfullscreen\n></iframe>\n```\n:::\n:::\n\n\n### Remove grid lines\nBecause we have removed the values on the y-axis, it's pointless to have the horizontal grid lines. We'll remove them and we'll also change the background color of the graph.\n\n::: {#7923a4dc .cell execution_count=6}\n``` {.python .cell-code}\nfig = go.Figure(go.Bar(\n    x=df[\"Country\"],\n    y=df[\"GDP\"],\n    text=df['GDP'],\n    textposition='outside'\n))\n\nfig.update_layout(\n    title=\"<b>Countries with the highest nominal GDP</b><br><sup><b>(in US $trillion, 2021)</b></sup>\",\n    title_font=dict(size=20),\n    yaxis=dict(showgrid=False, visible=False),\n    plot_bgcolor='#FFE4B5',\n    paper_bgcolor='#FFE4B5',\n)\n\nfig.show(renderer='iframe')\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<iframe\n    scrolling=\"no\"\n    width=\"100%\"\n    height=\"545px\"\n    src=\"iframe_figures/figure_6.html\"\n    frameborder=\"0\"\n    allowfullscreen\n></iframe>\n```\n:::\n:::\n\n\n### Include source and add padding\nFinally, let's include the source at the bottom of the graph. We'll also add padding (spacing) at the top and bottom of the graph so that the title text and the source text are not too close to the edge of the graph.\n\n::: {#57c9e9a9 .cell execution_count=7}\n``` {.python .cell-code}\nimport plotly.graph_objects as go\n\nfig = go.Figure(data=[\n    go.Bar(\n        x=df['Country'], \n        y=df['GDP'], \n        marker_color='#1E90FF',\n        text=df['GDP'],\n        textposition='outside'\n    )\n])\n\nfig.update_layout(\n    title=\"<b>Countries with the highest nominal GDP</b><br><sup><b>(in US $trillion, 2021)</b></sup>\",\n    title_font=dict(size=20),\n    plot_bgcolor='#FFE4B5',\n    paper_bgcolor='#FFE4B5',\n    yaxis=dict(showgrid=False, visible=False),\n    margin=dict(t=70, b=100)\n)\n\nfig.add_layout_image(\n    dict(\n        source=f\"data:image/png;base64,{encoded_image}\",\n        xref=\"paper\",\n        yref=\"paper\",\n        x=0.98,\n        y=-0.26,\n        xanchor=\"right\",\n        yanchor=\"bottom\",\n        sizex=0.22,\n        sizey=0.22,\n        layer=\"above\"\n    )\n)\n\nfig.add_annotation(\n    dict(\n        text=\"<b>Source</b>: IMF, April 2021\",\n        x=0.01,  # x position (0 means far left)\n        y=-0.26,  # y position (adjust as necessary)\n        xref=\"paper\",\n        yref=\"paper\",\n        showarrow=False,  # No arrow\n        font=dict(\n            size=11,  # Font size\n            color='grey'  # Font color\n        ),\n        align=\"left\"\n    ),\n)\n\nfig.show(renderer='iframe')\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<iframe\n    scrolling=\"no\"\n    width=\"100%\"\n    height=\"545px\"\n    src=\"iframe_figures/figure_7.html\"\n    frameborder=\"0\"\n    allowfullscreen\n></iframe>\n```\n:::\n:::\n\n\nNotice that I've added the logo for our data consulting company. Contact us if you need any services regarding your data.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}