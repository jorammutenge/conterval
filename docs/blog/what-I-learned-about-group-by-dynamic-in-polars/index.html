<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joram Mutenge">
<meta name="dcterms.date" content="2024-12-30">

<title>What I learned about group by dynamic in polars while working on a client’s project – Conterval</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-9d8b84d7a8b558c7dae144f7c63ee7dc.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f36b19b3496c6f75f970487af93de44b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5Y1ZXKXMBX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-5Y1ZXKXMBX', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Conterval</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul class="collapse">
  <li><a href="#a-brief-overview-of-the-project" id="toc-a-brief-overview-of-the-project" class="nav-link active" data-scroll-target="#a-brief-overview-of-the-project">A brief overview of the project</a></li>
  <li><a href="#how-we-solved-the-problem" id="toc-how-we-solved-the-problem" class="nav-link" data-scroll-target="#how-we-solved-the-problem">How we solved the problem</a></li>
  <li><a href="#creating-the-date-dataframe." id="toc-creating-the-date-dataframe." class="nav-link" data-scroll-target="#creating-the-date-dataframe.">Creating the date dataframe.</a></li>
  <li><a href="#joining-the-two-dataframes" id="toc-joining-the-two-dataframes" class="nav-link" data-scroll-target="#joining-the-two-dataframes">Joining the two dataframes</a></li>
  <li><a href="#converting-to-weekly-buckets" id="toc-converting-to-weekly-buckets" class="nav-link" data-scroll-target="#converting-to-weekly-buckets">Converting to weekly buckets</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">What I learned about group by dynamic in polars while working on a client’s project</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joram Mutenge </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-12-30</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>In the last client project I worked on, I learned something about the <code>group_by_dynamic</code> function in Polars. While what I learned was surprising, the fact that I learned it during the project was not. This aligns with the philosophy of “let the work be the practice” that Cal Newport advocates, and I’m proud to say I follow it. Most people spend time learning about a particular technology before they use it in a project. Cal Newport’s philosophy suggests combining learning with doing. By practicing through actual work, you gain mastery. By the end of this project, my proficiency in Polars increased dramatically.</p>
<section id="a-brief-overview-of-the-project" class="level2">
<h2 class="anchored" data-anchor-id="a-brief-overview-of-the-project">A brief overview of the project</h2>
<p>The client had forecast data for 2025 for electronic gadgets in monthly buckets, but she wanted it converted into weekly buckets. The dates in the data she presented all started at the beginning of each month. For instance, the first row contained the date January 1, 2025. Below is the forecast data from the client.</p>
<div id="4e716b6f" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (96, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Gadget</th>
<th data-quarto-table-cell-role="th">Forecast</th>
</tr>
<tr class="even">
<th>date</th>
<th>str</th>
<th>i16</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2025-01-01</td>
<td>"Headphones"</td>
<td>3439</td>
</tr>
<tr class="even">
<td>2025-01-01</td>
<td>"Keyboard"</td>
<td>1652</td>
</tr>
<tr class="odd">
<td>2025-01-01</td>
<td>"Monitor"</td>
<td>311</td>
</tr>
<tr class="even">
<td>2025-01-01</td>
<td>"Mouse"</td>
<td>1139</td>
</tr>
<tr class="odd">
<td>2025-01-01</td>
<td>"Printer"</td>
<td>123</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2025-12-01</td>
<td>"Mouse"</td>
<td>1385</td>
</tr>
<tr class="even">
<td>2025-12-01</td>
<td>"Printer"</td>
<td>166</td>
</tr>
<tr class="odd">
<td>2025-12-01</td>
<td>"Smartwatch"</td>
<td>678</td>
</tr>
<tr class="even">
<td>2025-12-01</td>
<td>"Tablet"</td>
<td>496</td>
</tr>
<tr class="odd">
<td>2025-12-01</td>
<td>"Webcam"</td>
<td>512</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="how-we-solved-the-problem" class="level2">
<h2 class="anchored" data-anchor-id="how-we-solved-the-problem">How we solved the problem</h2>
<p>At first, I thought I could solve the problem by simply dividing each forecast value by 7, the number of days in a week. However, a colleague quickly reminded me that not all months are created equal—some have more days than others. So, I quickly abandoned that approach and searched for an alternative.</p>
<p>The solution that worked involved creating, from scratch, a single-column dataframe containing all the days of the year 2025, from January to December. We joined this dataframe with the client’s forecast data and then applied <code>group_by_dynamic</code>. It worked like a charm, but it also exposed something I hadn’t been fully aware of regarding <code>group_by_dynamic</code>.</p>
</section>
<section id="creating-the-date-dataframe." class="level2">
<h2 class="anchored" data-anchor-id="creating-the-date-dataframe.">Creating the date dataframe.</h2>
<p>Using <code>datetime_range</code>, I created a dataframe containing timeseries values for the entire year of 2025. The interval was set to 1 day, ensuring that every single date in the year is included. Below is the resulting timeseries dataframe. Then I extracted the month values from the dates to create a new column <em>Month</em>.</p>
<div id="5756b2a2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>date_df <span class="op">=</span> pl.DataFrame(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Date"</span>: pl.datetime_range(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            start<span class="op">=</span>datetime(<span class="dv">2025</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>            end<span class="op">=</span>datetime(<span class="dv">2025</span>, <span class="dv">12</span>, <span class="dv">31</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            interval<span class="op">=</span><span class="st">"1d"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            eager<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>).with_columns(pl.col(<span class="st">'Date'</span>).dt.date(),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>               Month<span class="op">=</span>pl.col(<span class="st">'Date'</span>).dt.month())</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>date_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (365, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Month</th>
</tr>
<tr class="even">
<th>date</th>
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2025-01-01</td>
<td>1</td>
</tr>
<tr class="even">
<td>2025-01-02</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2025-01-03</td>
<td>1</td>
</tr>
<tr class="even">
<td>2025-01-04</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2025-01-05</td>
<td>1</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2025-12-27</td>
<td>12</td>
</tr>
<tr class="even">
<td>2025-12-28</td>
<td>12</td>
</tr>
<tr class="odd">
<td>2025-12-29</td>
<td>12</td>
</tr>
<tr class="even">
<td>2025-12-30</td>
<td>12</td>
</tr>
<tr class="odd">
<td>2025-12-31</td>
<td>12</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="joining-the-two-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="joining-the-two-dataframes">Joining the two dataframes</h2>
<p>Before joining the two DataFrames, I converted the date values in the forecast dataset to month-only values. This ensured a unique common value between both dataframes, enabling the join to proceed. The dataframe below illustrates the transformation from date values to month-only values.</p>
<div id="c4ca09ae" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (data</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> .with_columns(pl.col(<span class="st">'Date'</span>).dt.month())</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (96, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Gadget</th>
<th data-quarto-table-cell-role="th">Forecast</th>
</tr>
<tr class="even">
<th>i8</th>
<th>str</th>
<th>i16</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>"Headphones"</td>
<td>3439</td>
</tr>
<tr class="even">
<td>1</td>
<td>"Keyboard"</td>
<td>1652</td>
</tr>
<tr class="odd">
<td>1</td>
<td>"Monitor"</td>
<td>311</td>
</tr>
<tr class="even">
<td>1</td>
<td>"Mouse"</td>
<td>1139</td>
</tr>
<tr class="odd">
<td>1</td>
<td>"Printer"</td>
<td>123</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>12</td>
<td>"Mouse"</td>
<td>1385</td>
</tr>
<tr class="even">
<td>12</td>
<td>"Printer"</td>
<td>166</td>
</tr>
<tr class="odd">
<td>12</td>
<td>"Smartwatch"</td>
<td>678</td>
</tr>
<tr class="even">
<td>12</td>
<td>"Tablet"</td>
<td>496</td>
</tr>
<tr class="odd">
<td>12</td>
<td>"Webcam"</td>
<td>512</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
<p>The two dataframes were joined using a left join. Also, I decided to divide the forecast values by 4 since most months have at least 4 weeks Here’s an example of the resulting dataframe for Headphones showing the monthly and weekly forecast.</p>
<div id="6219436d" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(date_df</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> .join(df, left_on<span class="op">=</span><span class="st">'Month'</span>, right_on<span class="op">=</span><span class="st">'Date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> .drop(<span class="st">'Month'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> .with_columns(Weekly_Forecast<span class="op">=</span>pl.col(<span class="st">'Forecast'</span>).truediv(<span class="dv">4</span>).<span class="bu">round</span>(<span class="dv">0</span>).cast(pl.Int16))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> .sort(<span class="st">'Date'</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> .<span class="bu">filter</span>(pl.col(<span class="st">'Gadget'</span>) <span class="op">==</span> <span class="st">"Headphones"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (365, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Gadget</th>
<th data-quarto-table-cell-role="th">Forecast</th>
<th data-quarto-table-cell-role="th">Weekly_Forecast</th>
</tr>
<tr class="even">
<th>date</th>
<th>str</th>
<th>i16</th>
<th>i16</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2025-01-01</td>
<td>"Headphones"</td>
<td>3439</td>
<td>860</td>
</tr>
<tr class="even">
<td>2025-01-02</td>
<td>"Headphones"</td>
<td>3439</td>
<td>860</td>
</tr>
<tr class="odd">
<td>2025-01-03</td>
<td>"Headphones"</td>
<td>3439</td>
<td>860</td>
</tr>
<tr class="even">
<td>2025-01-04</td>
<td>"Headphones"</td>
<td>3439</td>
<td>860</td>
</tr>
<tr class="odd">
<td>2025-01-05</td>
<td>"Headphones"</td>
<td>3439</td>
<td>860</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2025-12-27</td>
<td>"Headphones"</td>
<td>2992</td>
<td>748</td>
</tr>
<tr class="even">
<td>2025-12-28</td>
<td>"Headphones"</td>
<td>2992</td>
<td>748</td>
</tr>
<tr class="odd">
<td>2025-12-29</td>
<td>"Headphones"</td>
<td>2992</td>
<td>748</td>
</tr>
<tr class="even">
<td>2025-12-30</td>
<td>"Headphones"</td>
<td>2992</td>
<td>748</td>
</tr>
<tr class="odd">
<td>2025-12-31</td>
<td>"Headphones"</td>
<td>2992</td>
<td>748</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="converting-to-weekly-buckets" class="level2">
<h2 class="anchored" data-anchor-id="converting-to-weekly-buckets">Converting to weekly buckets</h2>
<p>The dates are still in days, but the client wants them in weeks so I used <code>groub_by_dynamic</code> with an interval of 7 days to convert them into weekly buckets. Below is the resulting dataframe.</p>
<div id="2dbea5c0" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> great_tables <span class="im">import</span> loc, style</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>processed_df <span class="op">=</span> (date_df</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> .join(df, left_on<span class="op">=</span><span class="st">'Month'</span>, right_on<span class="op">=</span><span class="st">'Date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> .drop(<span class="st">'Month'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> .with_columns(Weekly_Forecast<span class="op">=</span>pl.col(<span class="st">'Forecast'</span>).truediv(<span class="dv">4</span>).<span class="bu">round</span>(<span class="dv">0</span>).cast(pl.Int16))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a> .sort(<span class="st">'Date'</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a> .<span class="bu">filter</span>(pl.col(<span class="st">'Gadget'</span>) <span class="op">==</span> <span class="st">"Headphones"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a> .group_by_dynamic(<span class="st">'Date'</span>, every<span class="op">=</span><span class="st">'7d'</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a> .agg(pl.first(<span class="st">'Gadget'</span>, <span class="st">'Forecast'</span>, <span class="st">'Weekly_Forecast'</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>processed_df[<span class="dv">0</span>:<span class="dv">10</span>].style.tab_style(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    style.fill(<span class="st">"yellow"</span>),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    loc.body(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        rows<span class="op">=</span>pl.col(<span class="st">"Date"</span>).dt.year() <span class="op">==</span> <span class="dv">2024</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div id="focxkuniog" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#focxkuniog table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#focxkuniog thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#focxkuniog p { margin: 0; padding: 0; }
 #focxkuniog .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #focxkuniog .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #focxkuniog .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #focxkuniog .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #focxkuniog .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #focxkuniog .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #focxkuniog .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #focxkuniog .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #focxkuniog .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #focxkuniog .gt_column_spanner_outer:first-child { padding-left: 0; }
 #focxkuniog .gt_column_spanner_outer:last-child { padding-right: 0; }
 #focxkuniog .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #focxkuniog .gt_spanner_row { border-bottom-style: hidden; }
 #focxkuniog .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #focxkuniog .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #focxkuniog .gt_from_md> :first-child { margin-top: 0; }
 #focxkuniog .gt_from_md> :last-child { margin-bottom: 0; }
 #focxkuniog .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #focxkuniog .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #focxkuniog .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #focxkuniog .gt_row_group_first td { border-top-width: 2px; }
 #focxkuniog .gt_row_group_first th { border-top-width: 2px; }
 #focxkuniog .gt_striped { background-color: rgba(128,128,128,0.05); }
 #focxkuniog .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #focxkuniog .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #focxkuniog .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #focxkuniog .gt_left { text-align: left; }
 #focxkuniog .gt_center { text-align: center; }
 #focxkuniog .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #focxkuniog .gt_font_normal { font-weight: normal; }
 #focxkuniog .gt_font_bold { font-weight: bold; }
 #focxkuniog .gt_font_italic { font-style: italic; }
 #focxkuniog .gt_super { font-size: 65%; }
 #focxkuniog .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #focxkuniog .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="Date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Date</th>
<th id="Gadget" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Gadget</th>
<th id="Forecast" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Forecast</th>
<th id="Weekly_Forecast" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Weekly_Forecast</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" style="background-color: yellow">2024-12-26</td>
<td class="gt_row gt_left" style="background-color: yellow">Headphones</td>
<td class="gt_row gt_right" style="background-color: yellow">3439</td>
<td class="gt_row gt_right" style="background-color: yellow">860</td>
</tr>
<tr class="even">
<td class="gt_row gt_right">2025-01-02</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">3439</td>
<td class="gt_row gt_right">860</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right">2025-01-09</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">3439</td>
<td class="gt_row gt_right">860</td>
</tr>
<tr class="even">
<td class="gt_row gt_right">2025-01-16</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">3439</td>
<td class="gt_row gt_right">860</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right">2025-01-23</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">3439</td>
<td class="gt_row gt_right">860</td>
</tr>
<tr class="even">
<td class="gt_row gt_right">2025-01-30</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">3439</td>
<td class="gt_row gt_right">860</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right">2025-02-06</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">2620</td>
<td class="gt_row gt_right">655</td>
</tr>
<tr class="even">
<td class="gt_row gt_right">2025-02-13</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">2620</td>
<td class="gt_row gt_right">655</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right">2025-02-20</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">2620</td>
<td class="gt_row gt_right">655</td>
</tr>
<tr class="even">
<td class="gt_row gt_right">2025-02-27</td>
<td class="gt_row gt_left">Headphones</td>
<td class="gt_row gt_right">2620</td>
<td class="gt_row gt_right">655</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p><br></p>
<p>Do you notice the peculiarity that <code>group_by_dynamic</code> introduces? None of our original DataFrames contained the year 2024, yet after using <code>group_by_dynamic</code>, we now see 2024. What’s going on here? I was initially unaware of this behavior. It turns out that <code>group_by_dynamic</code> shifts date values by the interval specified in the <code>every</code> parameter. Since we used a 7-day interval, the date values were moved 7 days back, causing the appearance of 2024.</p>
<p>But wait—the client specifically needs forecast data for 2025. How can we address this? Thankfully, the developers of Polars anticipated this issue and provided a solution. As outlined in the documentation, adding the <code>start_by</code> parameter with the value <code>"datapoint"</code> to <code>group_by_dynamic</code> resolves the problem. With this adjustment, the year 2024 disappeared entirely.</p>
<div id="94ca4247" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(date_df</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a> .join(df, left_on<span class="op">=</span><span class="st">'Month'</span>, right_on<span class="op">=</span><span class="st">'Date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> .drop(<span class="st">'Month'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a> .<span class="bu">filter</span>(pl.col(<span class="st">'Gadget'</span>) <span class="op">==</span> <span class="st">'Monitor'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> .with_columns(Weekly_Forecast<span class="op">=</span>pl.col(<span class="st">'Forecast'</span>).truediv(<span class="dv">4</span>).<span class="bu">round</span>(<span class="dv">0</span>).cast(pl.Int16))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> .sort(<span class="st">'Date'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a> .group_by_dynamic(<span class="st">'Date'</span>, every<span class="op">=</span><span class="st">'7d'</span>, start_by<span class="op">=</span><span class="st">'datapoint'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> .agg(pl.first(<span class="st">'Gadget'</span>, <span class="st">'Forecast'</span>, <span class="st">'Weekly_Forecast'</span>))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (53, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Gadget</th>
<th data-quarto-table-cell-role="th">Forecast</th>
<th data-quarto-table-cell-role="th">Weekly_Forecast</th>
</tr>
<tr class="even">
<th>date</th>
<th>str</th>
<th>i16</th>
<th>i16</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2025-01-01</td>
<td>"Monitor"</td>
<td>311</td>
<td>78</td>
</tr>
<tr class="even">
<td>2025-01-08</td>
<td>"Monitor"</td>
<td>311</td>
<td>78</td>
</tr>
<tr class="odd">
<td>2025-01-15</td>
<td>"Monitor"</td>
<td>311</td>
<td>78</td>
</tr>
<tr class="even">
<td>2025-01-22</td>
<td>"Monitor"</td>
<td>311</td>
<td>78</td>
</tr>
<tr class="odd">
<td>2025-01-29</td>
<td>"Monitor"</td>
<td>311</td>
<td>78</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2025-12-03</td>
<td>"Monitor"</td>
<td>325</td>
<td>81</td>
</tr>
<tr class="even">
<td>2025-12-10</td>
<td>"Monitor"</td>
<td>325</td>
<td>81</td>
</tr>
<tr class="odd">
<td>2025-12-17</td>
<td>"Monitor"</td>
<td>325</td>
<td>81</td>
</tr>
<tr class="even">
<td>2025-12-24</td>
<td>"Monitor"</td>
<td>325</td>
<td>81</td>
</tr>
<tr class="odd">
<td>2025-12-31</td>
<td>"Monitor"</td>
<td>325</td>
<td>81</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
<p>With the date issue resolved, we can now proceed to develop the code needed to create the final dataset for presentation to the client.</p>
<div id="a2ddeb79" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>gadget_list <span class="op">=</span> df[<span class="st">'Gadget'</span>].unique().to_list()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>bucket_dfs <span class="op">=</span> []</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> gadget <span class="kw">in</span> gadget_list:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    bucket_df <span class="op">=</span> (date_df</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        .join(df, left_on<span class="op">=</span><span class="st">'Month'</span>, right_on<span class="op">=</span><span class="st">'Date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        .drop(<span class="st">'Month'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">filter</span>(pl.col(<span class="st">'Gadget'</span>) <span class="op">==</span> gadget)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        .with_columns(Weekly_Forecast<span class="op">=</span>pl.col(<span class="st">'Forecast'</span>).truediv(<span class="dv">4</span>).<span class="bu">round</span>(<span class="dv">0</span>).cast(pl.Int16))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">'Date'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        .group_by_dynamic(<span class="st">'Date'</span>, every<span class="op">=</span><span class="st">'7d'</span>, start_by<span class="op">=</span><span class="st">'datapoint'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        .agg(pl.first(<span class="st">'Gadget'</span>, <span class="st">'Forecast'</span>, <span class="st">'Weekly_Forecast'</span>))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    bucket_dfs.append(bucket_df)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>all_bucket_df <span class="op">=</span> pl.concat(bucket_dfs).drop(<span class="st">'Forecast'</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>all_bucket_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (424, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Gadget</th>
<th data-quarto-table-cell-role="th">Weekly_Forecast</th>
</tr>
<tr class="even">
<th>date</th>
<th>str</th>
<th>i16</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2025-01-01</td>
<td>"Keyboard"</td>
<td>413</td>
</tr>
<tr class="even">
<td>2025-01-08</td>
<td>"Keyboard"</td>
<td>413</td>
</tr>
<tr class="odd">
<td>2025-01-15</td>
<td>"Keyboard"</td>
<td>413</td>
</tr>
<tr class="even">
<td>2025-01-22</td>
<td>"Keyboard"</td>
<td>413</td>
</tr>
<tr class="odd">
<td>2025-01-29</td>
<td>"Keyboard"</td>
<td>413</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2025-12-03</td>
<td>"Mouse"</td>
<td>346</td>
</tr>
<tr class="even">
<td>2025-12-10</td>
<td>"Mouse"</td>
<td>346</td>
</tr>
<tr class="odd">
<td>2025-12-17</td>
<td>"Mouse"</td>
<td>346</td>
</tr>
<tr class="even">
<td>2025-12-24</td>
<td>"Mouse"</td>
<td>346</td>
</tr>
<tr class="odd">
<td>2025-12-31</td>
<td>"Mouse"</td>
<td>346</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
<p>The lesson to remember is that <code>group_by_dynamic</code> will move the date values back by the specified interval you set in the <code>every</code> parameter. If you want to maintain the date values in your dataset, you must add ananother parameter <code>start_at</code> and set it to <code>"datapoint"</code>.</p>
<p>Reach out if you need help with your data problems. Also, take a look at our <a href="https://www.udemy.com/course/analyzing-data-with-polars-in-python/">Polars course</a> to improve your data analysis skills using this fast Python library.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.conterval\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2025 Conterval · <a href="mailto:contervalconsult@gmail.com">Contact</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>